services:
  - type: web
    name: rental-price-tracker
    env: docker
    plan: free
    autoDeploy: true
    healthCheckPath: /healthz
    # NOTE: Persistent disks require paid plans ($7/month+)
    # Using auto-create users on startup instead (FREE!)
    envVars:
      - key: ADMIN_PASSWORD
        sync: false  # Set in Dashboard - password for 'admin' user
      - key: CARLPAC82_PASSWORD
        sync: false  # Set in Dashboard - password for 'carlpac82' user
      - key: DPRUDENTE_PASSWORD
        sync: false  # Set in Dashboard - password for 'dprudente' user
      - key: APP_USERNAME
        sync: false
      - key: APP_PASSWORD
        sync: false
      - key: SECRET_KEY
        generateValue: true
      - key: USE_PLAYWRIGHT
        value: "1"
      - key: TEST_MODE_LOCAL
        value: "0"  # Real scraping mode (0=real scraping, 1=test URLs)
      - key: SCRAPER_SERVICE
        value: "scrapeops"
      - key: SCRAPER_API_KEY
        sync: false
      - key: SCRAPER_COUNTRY
        value: "pt"
      - key: FORCE_PROXY_FOR_CARJET
        value: "1"
      - key: TEST_FARO_URL
        sync: false
      - key: TEST_ALBUFEIRA_URL
        sync: false
      - key: TARGET_URL
        sync: false
      - key: CARJET_PRICE_ADJUSTMENT_PCT
        value: "3.12"
      - key: CARJET_PRICE_OFFSET_EUR
        value: "0"
      # NOTE: CRON_SECRET_KEY will use SECRET_KEY as fallback if not set
      # Uncomment below to generate a separate key (optional):
      # - key: CRON_SECRET_KEY
      #   generateValue: true

  # ========================================================
  # CRON JOBS (100% FREE!) - Backup for APScheduler
  # Nota: Render Cron usa UTC timezone
  # Portugal: UTC+0 (inverno) / UTC+1 (ver√£o)
  # ========================================================
  
  # Daily backup at 3 AM Lisboa (2 AM UTC winter / 3 AM UTC summer)
  - type: cron
    name: daily-backup
    env: docker
    schedule: "0 2 * * *"  # 2:00 AM UTC = 3:00 AM Lisboa (winter)
    dockerCommand: python3 -c "import requests; import os; requests.post('https://carrental-api-5f8q.onrender.com/api/cron/backup', headers={'X-Cron-Secret': os.environ['SECRET_KEY']})"
    envVars:
      - key: SECRET_KEY
        sync: false
  
  # Daily report search at 7 AM Lisboa (6 AM UTC winter / 7 AM UTC summer)
  - type: cron
    name: daily-report-search
    env: docker
    schedule: "0 6 * * *"  # 6:00 AM UTC = 7:00 AM Lisboa (winter)
    dockerCommand: python3 -c "import requests; import os; requests.post('https://carrental-api-5f8q.onrender.com/api/cron/daily-search', headers={'X-Cron-Secret': os.environ['SECRET_KEY']})"
    envVars:
      - key: SECRET_KEY
        sync: false
  
  # Daily report email at 9 AM Lisboa (8 AM UTC winter / 9 AM UTC summer)
  - type: cron
    name: daily-report-email
    env: docker
    schedule: "0 8 * * *"  # 8:00 AM UTC = 9:00 AM Lisboa (winter)
    dockerCommand: python3 -c "import requests; import os; requests.post('https://carrental-api-5f8q.onrender.com/api/cron/daily-report', headers={'X-Cron-Secret': os.environ['SECRET_KEY']})"
    envVars:
      - key: SECRET_KEY
        sync: false
  
  # Weekly report search on Monday at 7 AM Lisboa (6 AM UTC winter)
  - type: cron
    name: weekly-report-search
    env: docker
    schedule: "0 6 * * 1"  # Monday 6:00 AM UTC = 7:00 AM Lisboa (winter)
    dockerCommand: python3 -c "import requests; import os; requests.post('https://carrental-api-5f8q.onrender.com/api/cron/weekly-search', headers={'X-Cron-Secret': os.environ['SECRET_KEY']})"
    envVars:
      - key: SECRET_KEY
        sync: false
  
  # Weekly report email on Monday at 9 AM Lisboa (8 AM UTC winter)
  - type: cron
    name: weekly-report-email
    env: docker
    schedule: "0 8 * * 1"  # Monday 8:00 AM UTC = 9:00 AM Lisboa (winter)
    dockerCommand: python3 -c "import requests; import os; requests.post('https://carrental-api-5f8q.onrender.com/api/cron/weekly-report', headers={'X-Cron-Secret': os.environ['SECRET_KEY']})"
    envVars:
      - key: SECRET_KEY
        sync: false
